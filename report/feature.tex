\section{特征工程}
\label{sec:feature}

\subsection{对原数据集进行数值化}
\label{subsec:feature0}

由于原始的数据集中的字段除了经纬度之外都是使用字符串形式给出的，为了方便后面的处理，我们先对各个字符串字段进行数值化。每个字段的数值化方法不只一种，除了直接对应为一个整数之外，也有更合理的方式进行数值化。

\textbf{Date} 对于时间戳字符串，我们直接把它进行分割，拆成6个字段，即年、月、日、时、分、秒。每个字段都是一个整数。每一个字段的大小关系都是有含义的（时间的先后顺序、接近程度），因此使用整数是比较合理的。除了直接对应外，也可以进行离散化，比如对一天中的时间进行分段。但是在实验中，我们并没有进行这种尝试。

\textbf{DayofWeek} 对于星期几这个字段，我们直接把星期一到星期天编码为整数1到7。这个字段使用整数编码是有意义的，整数的大小关系可以表示星期的先后。但是，由于星期是来回轮转的，因此使用一个7维二进制向量对星期进行编码也是合理的：比如，$[\begin{array}{ccccccc}1&0&0&0&0&0&0\end{array}]$表示星期一，$[\begin{array}{ccccccc}0&1&0&0&0&0&0\end{array}]$表示星期二。

\textbf{PdDistrict} 警察局字段一共有10个不同的取值。我们可以直接地映射到1到10十个整数，但是这种编码是不合理的，因为这会在警察局之间引入大小关系（线性关系），而这种关系实际是不存在的（即，人为加入了干扰信息）。所以，更合理的方式是，使用10维的二进制向量进行编码。

\textbf{Address} 地址信息的处理比较棘手。地址字段有三种形式：一个街道名；两个街道名；或者一个街道名和一个街区号。在训练集和测试集中，一共出现了2128种街道名称，我们首先按照字典序对街道进行整数编码（1到2128）。然后使用如下方式，用两个整数表示地址：

\begin{itemize}
    \item 两条街道名的地址：使用两街道的编号，小编号在前、大编号在后；
    \item 街道和街区号的地址：首先是街区号的相反数（小于等于0），然后是街道编号。
    \item 单一街道名：首先是街道编号，然后是-1。
\end{itemize}

这是从字符地址到整数的一种直接翻译，这些整数之间的大小关系、线性关系都是没有实际意义的。显然这不是一种很好的编码方法。但是，由于Kaggle比赛要求不能引入外界信息，我们无法使用街道的朝向和相互之间的位置关系对街道进行编码，只能使用字典序这种办法进行编码。
在实验中，我们只利用了地址中的街道信息。

至此，我们得到了数据集直接数值化后的特征。经过这一处理的特征，虽然数值化的方法仍有不合理之处，但我们已经可以用这个特征来训练模型了。

\subsection{对于街道进行犯罪概率统计}
\label{subsec:feature3}

由于我们对于街道的编码方式不合理，我们希望构造新的特征来更好地刻画街道的特性。一个直观的想法是，统计各个街道上的犯罪概率分布。首先，统计各个街道上39种犯罪的总数。对于每一个地址，使用如下步骤构造特征：

\begin{enumerate}
    \item 如果地址中出现了两条街道，则对两个街道的犯罪计数求和。否则就直接取所在街道的犯罪频数。
    \item 进行Laplace平滑处理，即对每一类的频数加1。
    \item 计算每种犯罪类型在该街道上的频率$p_j = \frac{f_j} {\sum_{k=1}^M f_k}$，其中，$f_j$是类别$j$的频数，$M$为总类型数39。
    \item 把每个频率$p$替换成$logodds(p)=log\frac{p}{1-p}$。这一处理可以更好地刻画频率之间的大小差距。
\end{enumerate}

至此，我们使用39个浮点数刻画了犯罪地点所在街道的犯罪类型特征。注意到，上面对每类犯罪频率的计算是考虑了整个训练集的，即在时间上的粒度是很粗糙的。但是，如果每个街道上实际存在一个犯罪分布，那么在更长的时间段中计数应该能更准确地计算这个分布，所以这样对全局计数是合理的。

\subsection{利用时空数据点的K-最近邻信息}
\label{subsec:feature4}

利用经纬度坐标信息，我们可以计算两个数据点之间的距离，由此可以采用K-最近邻方法来进行预测。除了直接进行预测外，也可以根据K-最近邻的结果构造特征。此外，考虑到除了接近的地点可能有类似的犯罪类型分布之外，接近的时间也可能有类似的犯罪类型分布。根据第\ref{sec:observation}节中的结果，在时间的分布上，月份（直接与季节、节日相关）和小时（白天和半夜的犯罪情况差别很大）应该对于犯罪有很大的影响。于是，我们构造了四维数据点$(\begin{array}{cccc}X, & Y, & Month, & Hour\end{array})$进行K-最近邻分析。

注意到，通过欧式距离计算最近邻的时候，需要对各个维度进行标准化。特别是对于本数据集构造的这种四维数据点。其中，$X$的$25\%$分位数和$75\%$分位数的差只有$122.43 - 122.40 = 0.03$，同时$Y$的$25\%$分位数和$75\%$分位数的差也为$37.78 - 37.75 = 0.03$。而刻画时间的两个维度都是整数，差至少为$1$，远远大于经纬度之间的差。如果不做标准化处理，则时间的差别会掩盖掉经纬度的差别，这样进行最近邻分析就没有意义了。因此，对于4位数据点的每一个维度，使用下面的方法进行标准化：

\begin{equation*}
    X' = \frac{X - \bar{X}}{s}
\end{equation*}

其中，$\bar{X}$为该维坐标的平均值，$s$是该维全体坐标的标准差。由这些坐标点得到的K-最近邻信息，我们可以使用两种办法编成特征。其一，直接把KNN模型的预测概率结果作为特征；其二是根据最近邻的距离进行加权得到每个犯罪类型的权值。加权的方式，可以简单地对距离取倒数，即类型$i$的权重为：

\begin{equation*}
    w_i = \sum_{j=1}^N\frac{1}{d_{ij}}
\end{equation*}

\subsection{利用聚类结果构造特征}
\label{subsec:feature5}

对于一种犯罪，我们根据生活经验，认为其具有一定的空间局部性，就是说某些区域发生某种犯罪的几率会比较高。因此我们决定做一些处理来体现空间局部性。

对于每种犯罪，我们统计所有该种犯罪的记录的地点信息，可以得到二维平面点的信息，这些数据使用K-means算法进行聚类。但是对于一种犯罪，有几个犯罪中心实际上
是不确定的，K-means算法也不能自动分辨出有几种类别。为了解决这个问题，我们枚举了类别数进行计算，为了度量分几类最好，我们将数据分为两折，一折用来聚类，另
一折用来测试，用在测试集上和在训练集上的相对误差来选取一个最好的分类数。

如此，我们便得到了每种犯罪的若干中心，接下来我们把各个犯罪记录到每种犯罪的最近的中心距离计算出来，作为特征加入到特征向量之中。
